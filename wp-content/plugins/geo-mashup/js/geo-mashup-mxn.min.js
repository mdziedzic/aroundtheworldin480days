GeoMashup.loadFullPost=function(t){var o,e,a,n;a=this.getObjectsAtLocation(t),n=this.getOnObjectIDs(a),e=this.locationCache(t,"full-post-"+n.join(",")),e.html?this.getShowPostElement().innerHTML=e.html:(this.getShowPostElement().innerHTML='<div align="center"><img src="'+this.opts.url_path+'/images/busy_icon.gif" alt="Loading..." /></div>',o={url:this.geo_query_url+"&object_name="+this.opts.object_name+"&object_ids="+n.join(",")+"&template=full-post"},this.doAction("fullPostRequest",a,o),jQuery.get(o.url,function(t){var o={content:t};GeoMashup.doAction("fullPostLoad",a,o),e.html=o.content,jQuery(GeoMashup.getShowPostElement()).html(o.content),GeoMashup.doAction("fullPostChanged")}))},GeoMashup.createTermLine=function(t,o,e){var a={color:e.color,width:5,opacity:.5,visible:!0,taxonomy:t,term_id:o};e.line=new mxn.Polyline(e.points),this.doAction("termLine",e.line,t,o,e),this.doAction("categoryLine",this.opts,e.line),this.doAction("termLineOptions",a,t,o,e),this.doAction("categoryLineOptions",this.opts,a),this.map.addPolylineWithData(e.line,a),this.map.getZoom()>e.max_line_zoom&&this.hideLine(e.line)},GeoMashup.openInfoWindow=function(t){var o,e,a,n=t.location;this.open_window_marker&&!this.opts.multiple_info_windows&&this.open_window_marker.closeBubble(),a=this.getOnObjectIDs(this.getObjectsAtLocation(n)),e=this.locationCache(n,"info-window-"+a.join(",")),e.html?(t.setInfoBubble(e.html),t.openBubble()):(t.setInfoBubble('<div align="center"><img src="'+this.opts.url_path+'/images/busy_icon.gif" alt="Loading..." /></div>'),t.openBubble(),this.open_window_marker=t,o={url:this.geo_query_url+"&object_name="+this.opts.object_name+"&object_ids="+a.join(",")},this.doAction("markerInfoWindowRequest",t,o),jQuery.get(o.url,function(o){var a={content:o};t.closeBubble(),GeoMashup.doAction("markerInfoWindowLoad",t,a),e.html=GeoMashup.parentizeLinksMarkup(a.content),t.setInfoBubble(e.html),t.openBubble()}))},GeoMashup.closeInfoWindow=function(t){t.closeBubble()},GeoMashup.addGlowMarker=function(t){var o=t.location,e={clickable:!0,icon:this.opts.url_path+"/images/mm_36_glow.png",iconSize:[30,36],iconAnchor:[15,36]};this.glow_marker&&this.removeGlowMarker(),this.doAction("glowMarkerIcon",this.opts,e),this.glow_marker=new mxn.Marker(o),this.glow_marker.addData(e),this.glow_marker.click.addHandler(function(){GeoMashup.deselectMarker()}),this.map.addMarker(this.glow_marker)},GeoMashup.removeGlowMarker=function(){this.glow_marker&&(this.glow_marker.hide(),this.map.removeMarker(this.glow_marker),this.glow_marker=null)},GeoMashup.hideAttachments=function(){},GeoMashup.showMarkerAttachments=function(t){var o,e=[];this.hideAttachments(),o=this.getOnObjectIDs(this.getMarkerObjects(t)),jQuery.each(o,function(o,a){var n=GeoMashup.locationCache(t.location,"attachments-"+a);n.urls?jQuery.each(n.urls,function(t,o){GeoMashup.open_attachments.push(o),GeoMashup.map.addOverlay(o)}):e.push(a)}),jQuery.each(e,function(o,e){var a={action:"geo_mashup_kml_attachments"};a.post_ids=e,jQuery.getJSON(GeoMashup.opts.ajaxurl+"?callback=?",a,function(o){var a=GeoMashup.locationCache(t.location,"attachments-"+e);a.urls||(a.urls=[]),jQuery.each(o,function(t,o){a.urls.push(o),GeoMashup.open_attachments.push(o),GeoMashup.map.addOverlay(o)})})})},GeoMashup.addObjectIcon=function(t){"function"==typeof customGeoMashupCategoryIcon&&t.terms&&t.terms.hasOwnProperty("category")&&(t.icon=customGeoMashupCategoryIcon(GeoMashup.opts,t.terms.category)),t.icon||(jQuery.each(t.terms,function(o,e){var a;if(e.length>1)return t.icon=GeoMashup.clone(GeoMashup.multiple_term_icon),!1;if(1===e.length){if(a=GeoMashup.term_manager.getTermData(o,e[0],"icon"),t.icon&&t.icon.image!==a.image)return t.icon=GeoMashup.clone(GeoMashup.multiple_term_icon),!1;t.icon=GeoMashup.clone(a)}}),t.icon||(t.icon=GeoMashup.colorIcon("red")),this.doAction("objectIcon",GeoMashup.opts,t))},GeoMashup.createMarker=function(t,o){var e,a;return o.icon||this.addObjectIcon(o),a={label:o.title,icon:o.icon.image,iconSize:o.icon.iconSize,iconShadow:o.icon.iconShadow,iconAnchor:o.icon.iconAnchor,iconShadowSize:o.icon.shadowSize,visible:!0},this.doAction("objectMarkerOptions",this.opts,a,o),e=new mxn.Marker(t),e.addData(a),e.click.addHandler(function(){e===GeoMashup.selected_marker?GeoMashup.deselectMarker():GeoMashup.selectMarker(e)}),this.doAction("marker",this.opts,e),e},GeoMashup.clickObjectMarker=function(t,o){var e=this.objects[t];return GeoMashup.isObjectOn(e)?("undefined"==typeof o&&(o=1),void(e&&e.marker&&4>o&&(2>o?(o+=1,setTimeout(function(){GeoMashup.clickObjectMarker(t,o)},1e3)):e.marker.click.fire()))):!1},GeoMashup.colorIcon=function(t){var o=this.clone(this.base_color_icon);return o.image=this.opts.url_path+"/images/mm_36_"+t+".png",o},GeoMashup.getMarkerLatLng=function(t){return t.location},GeoMashup.hideMarker=function(t){t===this.selected_marker&&this.deselectMarker(),t.hide()},GeoMashup.showMarker=function(t){t.show()},GeoMashup.hideLine=function(t){try{t.hide()}catch(o){this.map.removePolyline(t)}t.setAttribute("visible",!1)},GeoMashup.showLine=function(t){try{t.show()}catch(o){this.map.addPolyline(t)}t.setAttribute("visible",!0)},GeoMashup.isLineVisible=function(t){return t.getAttribute("visible")},GeoMashup.newLatLng=function(t,o){return new mxn.LatLonPoint(t,o)},GeoMashup.extendLocationBounds=function(t){this.location_bounds?this.location_bounds.extend(t):this.location_bounds=new mxn.BoundingBox(t,t)},GeoMashup.addMarkers=function(t){this.forEach(t,function(t,o){this.map.addMarker(o)})},GeoMashup.makeMarkerMultiple=function(t){var o,e;"function"==typeof customGeoMashupMultiplePostImage&&(o=customGeoMashupMultiplePostImage(this.opts,t)),o||(o=this.opts.url_path+"/images/mm_36_plus.png"),e=t.iconUrl,t.setIcon(o),this.doAction("multiObjectMarker",this.opts,t),this.doAction("multiObjectIcon",this.opts,o),t.onmap&&t.iconUrl!==e&&(this.map.removeMarker(t),this.map.addMarker(t))},GeoMashup.setMarkerImage=function(t,o){t.iconUrl!==o&&(t.setIcon(o),t.onmap&&(this.map.removeMarker(t),this.map.addMarker(t)))},GeoMashup.autoZoom=function(){var t=this.map,o=function(){var e=parseInt(GeoMashup.opts.auto_zoom_max,10);t.getZoom()>e&&t.setZoom(e),t.changeZoom.removeHandler(o)};"undefined"!=typeof this.opts.auto_zoom_max&&this.map.changeZoom.addHandler(o),this.map.autoCenterAndZoom()},GeoMashup.isMarkerVisible=function(t){var o;try{o=this.map.getBounds()}catch(e){return!1}return t.getAttribute("visible")&&o&&o.contains(t.location)},GeoMashup.centerMarker=function(t,o){"number"==typeof o?this.map.setCenterAndZoom(t.location,o):this.map.setCenter(t.location,{},!0)},GeoMashup.createMap=function(t,o){var e,a,n,i,s,r,c,h,p=1,l={},m={};this.container=t,this.base_color_icon={},this.base_color_icon.image=o.url_path+"/images/mm_36_black.png",this.base_color_icon.iconShadow="",this.base_color_icon.iconSize=[30,36],this.base_color_icon.shadowSize=[0,0],this.base_color_icon.iconAnchor=[15,36],this.base_color_icon.infoWindowAnchor=[15,2],this.multiple_term_icon=this.clone(this.base_color_icon),this.multiple_term_icon.image=o.url_path+"/images/mm_36_mixed.png",this.forEach(o,function(t,e){("false"===e||"FALSE"===e)&&(o[t]=!1)}),this.have_parent_access=!1;try{"object"==typeof parent&&(parent.document.getElementById("bogus-test"),this.have_parent_access=!0)}catch(u){}if(o.home_url=o.siteurl,s={G_NORMAL_MAP:mxn.Mapstraction.ROAD,G_SATELLITE_MAP:mxn.Mapstraction.SATELLITE,G_HYBRID_MAP:mxn.Mapstraction.HYBRID,G_PHYSICAL_MAP:mxn.Mapstraction.PHYSICAL},"string"==typeof o.map_type?s[o.map_type]?o.map_type=s[o.map_type]:(a=parseInt(o.map_type,10),o.map_type=isNaN(a)||a>2?s.G_NORMAL_MAP:a):"undefined"==typeof o.map_type&&(o.map_type=s.G_NORMAL_MAP),this.map=new mxn.Mapstraction(this.container,o.map_api),i={enableDragging:!0},i.enableScrollWheelZoom=o.enable_scroll_wheel_zoom?!0:!1,"function"==typeof this.map.enableGeoMashupExtras&&this.map.enableGeoMashupExtras(),this.doAction("mapOptions",o,i),this.map.setOptions(i),this.map.setCenterAndZoom(new mxn.LatLonPoint(0,0),0),this.doAction("newMap",o,this.map),this.spinner_div=document.createElement("div"),this.spinner_div.innerHTML='<div id="gm-loading-icon" style="-moz-user-select: none; z-index: 100; position: absolute; left: '+(jQuery(this.container).width()/2-64)+"px; top: "+(jQuery(this.container).height()/2-7)+'px;"><img style="border: 0px none ; margin: 0px; padding: 0px; width: 128px; height: 15px; -moz-user-select: none;" src="'+o.url_path+'/images/busy_icon.gif"/></a></div>',this.showLoadingIcon(),this.map.load.addHandler(function(){GeoMashup.hideLoadingIcon()}),o.object_name||(o.object_name="post"),this.opts=o,m.url=o.siteurl+(o.siteurl.indexOf("?")>0?"&":"?")+"geo_mashup_content=geo-query&map_name="+encodeURIComponent(o.name),o.lang&&-1===m.url.indexOf("lang=")&&(m.url+="&lang="+encodeURIComponent(o.lang)),this.doAction("geoQueryUrl",this.opts,m),this.geo_query_url=m.url,this.map.changeZoom.addHandler(function(){GeoMashup.adjustZoom(),GeoMashup.adjustViewport()},this),this.map.endPan.addHandler(function(){GeoMashup.adjustViewport()},this),p="auto"!==o.zoom&&"string"==typeof o.zoom?parseInt(o.zoom,10):o.zoom,o.load_kml)try{o.load_kml=jQuery("<div/>").html(o.load_kml).text(),"auto"===p?this.map.addOverlay(o.load_kml,!0):this.map.addOverlay(o.load_kml)}catch(d){}this.term_manager&&this.term_manager.load();try{this.map.setMapType(o.map_type)}catch(_){}if("auto"!==p&&(o.center_lat&&o.center_lng?this.map.setCenterAndZoom(new mxn.LatLonPoint(parseFloat(o.center_lat),parseFloat(o.center_lng)),p):o.object_data&&o.object_data.objects[0]?(n=new mxn.LatLonPoint(parseFloat(o.object_data.objects[0].lat),parseFloat(o.object_data.objects[0].lng)),this.map.setCenterAndZoom(n,p)):(r=this.geo_query_url+"&limit=1",o.map_cat&&(r+="&map_cat="+o.map_cat),jQuery.getJSON(r,function(t){t.length>0&&(n=new mxn.LatLonPoint(parseFloat(t[0].lat),parseFloat(t[0].lng)),this.map.setCenterAndZoom(n,p))}))),this.location_bounds=null,"single"===o.map_content?o.object_data&&o.object_data.objects.length&&!o.load_kml&&(c={visible:!0},"function"==typeof customGeoMashupSinglePostIcon&&(c=customGeoMashupSinglePostIcon(this.opts)),c.image||(c=this.colorIcon("red"),c.icon=c.image),this.doAction("singleMarkerOptions",this.opts,c),h=new mxn.Marker(new mxn.LatLonPoint(parseFloat(o.object_data.objects[0].lat),parseFloat(o.object_data.objects[0].lng))),this.map.addMarkerWithData(h,c),this.doAction("singleMarker",this.opts,h)):o.object_data?this.addObjects(o.object_data.objects,!0):(this.requestObjects(!0),this.requestObjects(!1)),"GSmallZoomControl"===o.map_control||"GSmallZoomControl3D"===o.map_control?l.zoom="small":"GSmallMapControl"===o.map_control?(l.zoom="small",l.pan=!0):("GLargeMapControl"===o.map_control||"GLargeMapControl3D"===o.map_control)&&(l.zoom="large",l.pan=!0),o.add_map_type_control&&(l.map_type=!0),o.add_overview_control&&(l.overview=!0),this.map.addControls(l),o.add_map_type_control&&"function"==typeof this.map.setMapTypes){for("string"==typeof o.add_map_type_control&&(o.add_map_type_control=o.add_map_type_control.split(/\s*,\s*/),"undefined"==typeof s[o.add_map_type_control[0]]&&(o.add_map_type_control=["G_NORMAL_MAP","G_SATELLITE_MAP","G_PHYSICAL_MAP"])),o.mxn_map_type_control=[],e=0;e<o.add_map_type_control.length;e+=1)o.mxn_map_type_control.push(s[o.add_map_type_control[e]]);this.map.setMapTypes(o.mxn_map_type_control)}this.map.load.addHandler(function(){GeoMashup.updateVisibleList()}),"function"==typeof customizeGeoMashupMap&&customizeGeoMashupMap(this.opts,this.map),"function"==typeof customizeGeoMashup&&customizeGeoMashup(this),this.hideLoadingIcon(),this.doAction("loadedMap",this.opts,this.map)};